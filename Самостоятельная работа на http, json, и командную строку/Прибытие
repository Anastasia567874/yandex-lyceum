import argparse
import requests
import csv

parser = argparse.ArgumentParser()
parser.add_argument('host')
parser.add_argument('port')
parser.add_argument('key')
parser.add_argument('--smallest', default=10, type=int)
parser.add_argument('--largest', default=100, type=int)
arg = parser.parse_args()
host = arg.host
port = arg.port
key = arg.key
largest = arg.largest
smallest = arg.smallest
response = requests.get(f'http://{host}:{port}')
json_response = response.json()
with open('statistics.csv', 'w', newline='') as csvfile:
    writer = csv.writer(
        csvfile, delimiter=';', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    for i in json_response[key]:
        max_zn_name = False
        max_zn = False
        min_zn_name = False
        min_zn = False
        s = 0
        for j in i.keys():
            if smallest < i[j] < largest:
                if max_zn is False or max_zn < i[j]:
                    max_zn = i[j]
                    max_zn_name = j
                if min_zn is False or min_zn > i[j]:
                    min_zn = i[j]
                    min_zn_name = j
                s += i[j]
        writer.writerow([max_zn_name, max_zn, min_zn_name, min_zn, s])